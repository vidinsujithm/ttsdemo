<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Integra TTS Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <style>
      body {
        background-color: #fff;
        color: #333;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      header {
        text-align: center;
        padding: 1rem;
        border-bottom: 2px solid #eee;
      }
      header img {
        max-height: 80px;
      }
      h1 {
        max-width: 480px;
        margin: 1.5rem auto;
        font-size: 1.8rem;
        text-align: center;
      }
      form {
        max-width: 480px;
        margin: 0 auto;
        padding: 1rem;
      }
      button, select {
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-radius: 4px;
        height: 2rem;
        cursor: pointer;
        padding: 0 0.5rem;
      }
      button:hover, select:hover {
        background-color: #eee;
      }
      select {
       -webkit-appearance: none;
       -moz-appearance: none;
       appearance: none;
     }

     input[type=range] {
      -webkit-appearance: none;
      width: 100%;
     }
     input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      background: #333;
      cursor: pointer;
      border-radius: 50%;
     }
     input[type=range]::-webkit-slider-runnable-track {
      height: 4px;
      background: #ccc;
      border-radius: 2px;
     }

      .speecharg {
        height: 2.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }
      .speecharg label {
        display: inline-block;
        width: 20%;
        font-weight: bold;
      }
      .speecharg input, .speecharg select {
        display: inline-block;
        width: calc(80% - 3rem);
        margin: 0;
      }
      .speecharg button {
        width: 2rem;
        height: 2rem;
        margin-left: 0.5rem;
        padding: 0;
      }

      .bottom {
        margin: 1rem 0;
        display: flex;
        justify-content: space-between;
        gap: 1rem;
      }

      .bottom button.small {
        height: 2rem;
        width: 2rem;
        padding: 0;
      }

      #textarea {
         width: 100%;
         height: 8rem;
         display: block;
         margin-bottom: 1rem;
         border-radius: 5px;
         border: 1px solid #ccc;
         position: relative;
         background-color: #fff;
         transition: background-color 100ms ease;
       }

       .speaking #textarea {
        background-color: #f0f0f0;
       }

      #textarea > * {
        position: absolute;
        display: block;
        border: none;
        resize: none;
        top: 0;
        left: 0;
        width: calc(100% - 1rem);
        height: calc(100% - 1rem);
        margin: .5rem;
        padding: 0;
        white-space: pre-wrap;
        line-height: 1.2rem;
        background-color: transparent;
        font-size: 14px;
        font-family: monospace;
      }

      #textbeingspoken {
        color: #888;
        visibility: hidden;
        opacity: 0;
        overflow: auto;
        transition: all 100ms ease;
       }

       .speaking #textbeingspoken {
        visibility: visible;
        opacity: 1;
       }

      #marker {
        position: absolute;
        visibility: hidden;
        border: 1px solid orange;
      }

      #marker.moved {
        visibility: visible;
      }

      #marker.animate {
        transition: all 50ms ease;
      }

      button > img {
        width: 100%;
        height: auto;
      }

      .widebutton {
        width: 9rem;
      }

      .widebutton > button {
        display: block;
        margin-bottom: 0.25rem;
        width: 100%;
      }

    </style>
  </head>
  <body class="loading">
    <header>
      <img src="https://integranxt.com/wp-content/uploads/2025/01/logo.png" alt="Integra Software Services Pondicherry">
    </header>
    <h1>Speech Synthesis - TTS Demo</h1>
    <form>
      <div id="textarea">
        <textarea id="texttospeak">Low back pain is one of the most common reasons for physician visits in the United States. Most Americans have experienced low back pain, and approximately one quarter of U.S. adults reported having low back pain lasting at least 1 day in the past 3 months. Low back pain is associated with high costs, including those related to health care and indirect costs from missed work or reduced productivity. The total costs attributable to low back pain in the United States were estimated at $100 billion in 2006, two thirds of which were indirect costs of lost wages and productivity.</textarea>
        <div id="textbeingspoken"></div>
      </div>
      <div class="speecharg">
        <label for="pitch">Pitch</label>
        <input id="pitch" type="range" value="0.5" min="0" max="1" step="0.05">
        <!-- <button type="button" title="Reset pitch" onclick="resetPitch();">&#x21b6;</button> -->
      </div>
      <div class="speecharg">
        <label for="rate">Rate</label>
        <input id="rate" type="range" value="0" min="-3" max="3" step="0.25">
        <!-- <button type="button" title="Reset rate" onclick="resetRate();">&#x21b6;</button> -->
      </div>
      <div class="speecharg">
        <label for="volume">Volume</label>
        <input id="volume" type="range" value="1" min="0" max="1" step="0.05">
        <!-- <button type="button" title="Reset volume" onclick="resetVolume();">&#x21b6;</button> -->
      </div>
      <div class="speecharg">
        <label for="voice">Voice</label>
        <select id="voice"></select>
        <button type="button" title="Reset voice" onclick="resetVoice();">&#x21b6;</button>
      </div>
      <div class="bottom">
        <div class="widebutton">
          <button type="button" onclick="speak();"><strong>Speak it</strong></button>
          <!-- <button type="button" onclick="stop(); speak();">Interrupt</button> -->
        </div>
        <button type="button" class="small" title="Pause/Resume" onclick="playpause();"><img src="play_pause.svg" alt="Pause/Resume"></button>
        <button type="button" class="small" title="Cancel" onclick="stop();"><img src="stop.svg" alt="Stop"></button>
      </div>
    </form>
    <div id="marker"></div>

    <script>
      function resetPitch() { document.getElementById('pitch').value = 0.5; }
      function resetRate() { document.getElementById('rate').value = 0; }
      function resetVolume() { document.getElementById('volume').value = 1; }
      function resetVoice() { document.getElementById('voice').selectedIndex = 0; }

      var texttospeak = document.getElementById('texttospeak');
      var textbeingspoken = document.getElementById('textbeingspoken');
      var marker = document.getElementById('marker');
      var range = document.createRange();
      var speechtext;
      var firstBoundary;

      var voices = [];
      function populateVoiceList() {
        voices = window.speechSynthesis.getVoices();
        var selectElm = document.querySelector('#voice');
        selectElm.innerHTML = '';
        voices.forEach((v,i) => {
          var option = document.createElement('option');
          option.textContent = `${v.name} (${v.lang})`;
          option.value = v.voiceURI;
          option.voice = v;
          if (v.default) option.selected = true;
          selectElm.appendChild(option);
        });
      }

      populateVoiceList();
      if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
      }

      function stop() { speechSynthesis.cancel(); }
      function playpause() {
        if (speechSynthesis.paused) speechSynthesis.resume();
        else speechSynthesis.pause();
      }

      function speak() {
        speechtext = texttospeak.value;
        firstBoundary = true;
        textbeingspoken.textContent = speechtext;

        const utterance = new SpeechSynthesisUtterance(texttospeak.value);
        utterance.voice = voices[document.getElementById('voice').selectedIndex];
        utterance.volume = document.getElementById('volume').value;
        utterance.pitch = document.getElementById('pitch').value;
        var rate = document.getElementById('rate').value;
        utterance.rate = Math.pow(Math.abs(rate) + 1, rate < 0 ? -1 : 1);

        utterance.addEventListener('start', () => {
          marker.classList.remove('animate');
          document.body.classList.add('speaking');
        });
        utterance.addEventListener('end', handleSpeechEvent);
        utterance.addEventListener('error', handleSpeechEvent);
        utterance.addEventListener('boundary', handleSpeechEvent);
        utterance.addEventListener('pause', handleSpeechEvent);
        utterance.addEventListener('resume', handleSpeechEvent);

        speechSynthesis.speak(utterance);
      }

      function handleSpeechEvent(e) {
        switch (e.type) {
          case 'end':
          case 'error':
            document.body.classList.remove('speaking');
            marker.classList.remove('moved');
            break;
          case 'boundary':
            if (e.name !== 'word') break;
            var substr = speechtext.slice(e.charIndex);
            var rex = /\S+/g;
            var res = rex.exec(substr);
            if (!res) return;
            var startOffset = res.index + e.charIndex;
            var endOffset = rex.lastIndex + e.charIndex;
            range.setStart(textbeingspoken.firstChild, startOffset);
            range.setEnd(textbeingspoken.firstChild, endOffset);
            var rect = range.getBoundingClientRect();
            var delta = 0;
            var parentRect = textbeingspoken.getBoundingClientRect();
            if (rect.bottom > parentRect.bottom) delta = rect.bottom - parentRect.bottom;
            if (rect.top < parentRect.top) delta = rect.top - parentRect.top;
            textbeingspoken.scrollTop += delta;
            texttospeak.scrollTop = textbeingspoken.scrollTop;
            marker.style.top = rect.top - delta - 1 + "px";
            marker.style.left = rect.left - 1 + "px";
            marker.style.width = rect.width + 1 + "px";
            marker.style.height = rect.height + 1 + "px";
            marker.classList.add('moved');
            if (firstBoundary) {
              firstBoundary = false;
              marker.classList.add('animate');
            }
            break;
        }
      }
    </script>
  </body>
</html>
